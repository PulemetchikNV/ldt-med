# LDT Med — сервис классификации КТ органов грудной клетки

Мини-платформа для врачей-рентгенологов, объединяющая веб-интерфейс, API и вспомогательные утилиты. Решение реализует загрузку исследований (ZIP с DICOM-срезами), отправку их в облачную ML-модель и представление результатов в удобном UI и XLSX-отчётах.

## Основные возможности и ограничения

- загрузка ZIP-архивов с исследованиями КТ ОГК и получение классификации «норма / патология»;
- просмотр прогресса и результатов в панели врача, ручной запрос анализа одиночных DICOM-файлов;
- формирование Excel-отчёта через CLI-скрипт `classify-to-xlsx` (использует `MLService.classifyDicom`);
- адаптивный интерфейс на Vue 3 + PrimeVue, бэкенд на Fastify/TypeScript.

Ограничения текущей версии:

- поддерживаются только ZIP-архивы, содержащие DICOM-файлы без вложенных архивов;
- распознавание UID берётся из первых найденных DICOM-файлов, при повреждённых данных UID может быть пустым;
- маски патологий и дополнительные визуализации не сохраняются (опциональная часть ТЗ пока не реализована).

## Системные требования

Минимальный набор для локального развёртывания:

- Docker Engine 24+ и docker compose plugin 2.20+;
- 12 ГБ свободного места (для контейнеров и артефактов);
- 8 ГБ ОЗУ для комфортной работы с ML-сервисом;
- для ручного запуска без Docker: Node.js 20+, npm 10+, Python 3.10+ (если нужен ML-прототип).

## Quick Start

```bash
# 1. Клонируйте репозиторий
git clone <repo-url>
cd ldt-med

# 2. Создайте .env файлы по примеру (env.example)
cp env.example .env
# (укажите ML_DICOM_CLASSIFY_URL, учётные данные БД и пр.)

# 3. Соберите и запустите окружение разработки
docker compose -f docker-compose.dev.yml up --build

# 4. Приложение будет доступно по адресу http://localhost:5173 (frontend)
#    Backend слушает http://localhost:3000
```

### Пример генерации XLSX-отчёта (в контейнере)

```bash
# Запустит backend-контейнер, выполнит классификацию и положит отчёт в ./reports
mkdir -p reports datasets
# (поместите ZIP с исследованиями в ./datasets)
docker compose -f docker-compose.dev.yml run --rm \
  -v "$PWD/datasets:/app/datasets" \
  -v "$PWD/reports:/app/reports" backend \
  npm run classify-to-xlsx -- ./datasets --out ./reports/classification.xlsx
```

## Структура проекта

```
ldt-med/
├─ backend/                # Fastify API, скрипты экспорта XLSX
│  ├─ src/services/mlService.ts      # Обёртка над внешним ML API
│  ├─ src/scripts/classifyToXlsx.ts  # CLI генерации отчёта
│  └─ README.md                       # Документация по backend
├─ frontend/               # Vue 3 + PrimeVue веб-интерфейс
│  └─ src/views/           # Страницы Login/Register/Dashboard/DicomInsights
├─ ml/                     # (опционально) ML-сервис на FastAPI
├─ docker-compose.yml      # Композиция для продакшн-развёртывания
├─ docker-compose.dev.yml  # Локальная разработка
└─ docs/                   # Дополнительная документация
```

## Руководство по развертыванию

1. **Переменные окружения**: заполните `.env` и файлы окружения внутри `backend/` и `frontend/` (см. README соответствующих модулей).
2. **В разработке**: `docker compose -f docker-compose.dev.yml up --build`. Frontend (Vite) и backend (Fastify) запускаются в watch-режиме. Для классификации используется уже развернутый ML endpoint `http://83.151.2.50:9174/classify-study` (значение прописано в docker-compose, дополнительно в `.env` указывать не требуется).
3. **В продакшене**: `docker compose up --build -d` использует `docker-compose.yml` c оптимизированными образами и службами БД/ML. Параметр `ML_DICOM_CLASSIFY_URL` уже задан в compose-файлах и указывает на `http://83.151.2.50:9174/classify-study`; редактируйте его только при смене удалённого сервиса. Остальные переменные (`NODE_ENV`, `POSTGRES_*`, SSL) настройте под своё окружение.
4. **Журналы**: `docker compose logs -f <service>` — для мониторинга работы сервисов.

## Руководство пользователя

1. **Авторизация**: перейдите на `/login`, авторизуйтесь под учётной записью организации. При отсутствии доступа используйте «Подать заявку на регистрацию».
2. **Рабочая панель**: в разделе «Оперативный контроль» загрузите ZIP с DICOM-срезами. После обработки отобразятся результат «Норма / Патология» и пояснения.
3. **Анализ одиночного DICOM**: в разделе «Загрузка исследований» (Dicom Insights) можно проверить отдельный `.dcm` файл, получить текстовый обзор и вероятность патологии.
4. **Экспорт классификации**: при необходимости отчёта запустите `npm run classify-to-xlsx` (пример выше). В таблицу попадут статус обработки, вероятность патологии, UID исследования и время обработки.
5. **Ошибки обработки**: в UI и в XLSX-отчёте отображается причина сбоя (например, некорректный ZIP). При повторяемых ошибках проверьте корректность данных и доступность удалённого ML endpoint.

---

Проект соответствует требованиям хакатона «Поиск патологий в КТ органов грудной клетки» и может служить основой для дальнейшего расширения (сохранение масок патологий, дополнительные аналитику и т.д.).
